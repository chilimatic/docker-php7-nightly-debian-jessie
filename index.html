<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Docker-php7-nightly-debian-jessy by chilimatic</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Docker-php7-nightly-debian-jessy</h1>
      <h2 class="project-tagline">Docker Container with supervisor which downloads the latest master and initializes only a php-fpm instance</h2>
      <a href="https://github.com/chilimatic/docker-php7-nightly-debian-jessy" class="btn">View on GitHub</a>
      <a href="https://github.com/chilimatic/docker-php7-nightly-debian-jessy/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/chilimatic/docker-php7-nightly-debian-jessy/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="docker-php7-nightly-debian-jessy" class="anchor" href="#docker-php7-nightly-debian-jessy" aria-hidden="true"><span class="octicon octicon-link"></span></a>docker-php7-nightly-debian-jessy</h1>

<p>Docker Container with supervisor which downloads the latest master and initializes only php-fpm instance based on php7</p>

<p>Why another one ? I don't use Ubuntu and I'm not a fan of having to many services in a container -&gt; the idea is to have the <strong>PHP-FPM listen to the port 8099</strong> on the outside and the <strong>path/to/the/project mounted on the inside</strong> so I can choose whatever server on the outside I'd like.</p>

<h2>
<a id="fyi-about-docker" class="anchor" href="#fyi-about-docker" aria-hidden="true"><span class="octicon octicon-link"></span></a>FYI about Docker</h2>

<p>First of all this is Docker &lt;-&gt; it's based on LXC which means it's a virtualisation within the linux kernel. </p>

<p>This is not like Vagrant which is a Batch System to store states / versions of complete hybrid virtualisations. </p>

<p>Docker is as mentioned before a linux container (lxc). Hence needs less resources but does not support Windows or Mac on a native lvl for more information please check <a href="http://boot2docker.io/">http://boot2docker.io/ </a> as a Mac user as a windows user I'm sorry afaik you need a VM &lt;-&gt; I would recommend Ubuntu since the packages for ubuntu are compiled and maintained by the zend guys.</p>

<p>Please do not mistake a service container with a complete virtualisation like VBOX or VM, ..</p>

<h2>
<a id="fyi-php7" class="anchor" href="#fyi-php7" aria-hidden="true"><span class="octicon octicon-link"></span></a>FYI PHP7</h2>

<p>PHP 7 atm (<strong>2015-05-10</strong>) is as we all should know still in Development so a lot of external extensions are not working due to the renaming of c header files and changing of the inner structure. So the compilation is ending in fatal errors. I tried it with <strong>redis</strong>, <strong>mongo</strong> and <strong>memcached</strong></p>

<p>During the compilation there are several errors which I ignored.</p>

<h2>
<a id="configurations" class="anchor" href="#configurations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configurations</h2>

<p>I compiled it manually you can have a look about the configuration settings (./configure) at the following sources <a href="http://www.phpinternalsbook.com/build_system/building_php.html">phpinternals</a> or <a href="http://php.net/manual/en/configure.about.php">php.net</a> and ofc the bash approach <code>./configure --help | less</code></p>

<h2>
<a id="supervisor" class="anchor" href="#supervisor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supervisor</h2>

<p>Since Docker is not Vagrant the processes can not simply be put in the init.d or system.d structure and triggered. Many other boxes use internal batches I followed the OPs approach and used the supervisor. </p>

<p>You can have a look at the supervisord.conf and see how a rather lazy approach has been done. Which is less work than copying batch files and trigger them via bashrc or other approaches. Taste I guess.</p>

<h2>
<a id="fpm" class="anchor" href="#fpm" aria-hidden="true"><span class="octicon octicon-link"></span></a>FPM</h2>

<p>The FPM config <strong>php-fpm.conf</strong> is only setting the pid folder and the error folder.
The <strong>User and Group</strong> which for the workers are in the <strong><a href="http://www.conf">www.conf</a></strong> as well as the <strong>listenport 8080</strong> on the inside. </p>

<p>Since I don't expect a lot of OPs knowledge from a common Dev (the have other concerns) this is already pre-configured and listens to the 8099 port on your host machine.</p>

<p>I didn't want to bother with doing the socket approach which would require more detailed knowledge of the user. 
Although it's pretty easy once you understand the <a href="https://docs.docker.com/articles/basics/">docker basics</a>
Please do use it I wanted to keep this accessible for people who just want to code.</p>

<p>There are a lot of .inis which have no use since you can't compile the extensions still i left them in there because who know's what's in 2-3 Months.</p>

<h2>
<a id="general-knowledge" class="anchor" href="#general-knowledge" aria-hidden="true"><span class="octicon octicon-link"></span></a>General Knowledge</h2>

<p>** It's important that your data is accessible in the Container **
<code>-v /var/www:/var/www &lt;nameofyourchoosing&gt;</code>
this is a basic mapping of the outside to the inside &lt;-&gt; make sure it has the proper permissions 
go with www-data this the common apache / nginx user|group and is available within debian. </p>

<p>if you really don't have a clue and this is your private machine (VM) just change the mod of all files to 0777 this is the admin nightmare but the usual Dev solution.</p>

<p>this is a basic setup that should work with every linux version that supports docker <strong>except the packages | apt vs yum vs rpm ...</strong></p>

<p><code>docker run -p 127.0.0.1:8099:8080</code> maps your localhost:8099 to the internal container port 8080 if you change the fpm config please do not forget to adapt this setting you can use autoport mapping :) please consult the <a href="https://docs.docker.com/articles/basics/">docker basics</a> </p>

<p>I added an nginx example and an Apache2.4 example and ofc the basics to create / start / access Docker in the tl;dr section.</p>

<hr>

<h1>
<a id="tldr" class="anchor" href="#tldr" aria-hidden="true"><span class="octicon octicon-link"></span></a>TL;DR</h1>

<p>Basic usage
inside the repos root dir:</p>

<p><code>docker build -t &lt;nameofyourchoosing&gt; .</code></p>

<p>then</p>

<p><code>docker run -d -p 127.0.0.1:8099:8080  -v /var/www:/var/www &lt;nameofyourchoosing&gt;</code></p>

<p><strong>127.0.0.1:8099:8080 -&gt; 8099 is the port on the outside</strong>
<strong>-v /inside/docker:/outside/docker</strong>
** -d deamonize **</p>

<p>to check if it's running
<code>docker ps</code></p>

<p>to login as root into the bash
<code>docker exec -it &lt;containerID&gt; bash</code></p>

<p>to get nginx to pipe the request to php-fpm</p>

<pre><code>  `  location ~ [^/]\.php(/|$) {`
            `fastcgi_split_path_info ^(.+?\.php)(/.*)$;`
            `# NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini`
            `if (!-f $document_root$fastcgi_script_name) {`
                    `return 404;`
            `}`

            `# With php5-cgi alone:`
            `fastcgi_pass 127.0.0.1:8099;`
            `fastcgi_index index.php;`
            `include fastcgi_params;`
    `}`
</code></pre>

<p>to get the apache2.4
those two modules need to be loaded !</p>

<p>LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</p>

<p>inside the virtualhost
ProxyPassMatch ^/(.<em>.php(/.</em>)?)$ fcgi://127.0.0.1:8099/path/to/your/documentroot/$1
DirectoryIndex /index.php</p>

<p>And now to the glosar of all pages consulted or used during the last 24 hours building this container </p>

<h3>
<a id="apache" class="anchor" href="#apache" aria-hidden="true"><span class="octicon octicon-link"></span></a>apache</h3>

<ul>
<li><a href="https://wiki.apache.org/httpd/PHP-FPM">https://wiki.apache.org/httpd/PHP-FPM</a></li>
<li><a href="http://httpd.apache.org/docs/current/mod/core.html">http://httpd.apache.org/docs/current/mod/core.html</a></li>
</ul>

<h3>
<a id="php" class="anchor" href="#php" aria-hidden="true"><span class="octicon octicon-link"></span></a>php</h3>

<ul>
<li>
<a href="https://github.com/php-memcached-dev/php-memcached">https://github.com/php-memcached-dev/php-memcached</a> &lt;-&gt; compilation error</li>
<li><a href="http://pecl.php.net/package/memcached">http://pecl.php.net/package/memcached</a></li>
<li><a href="http://www.sohailriaz.com/how-to-install-memcached-with-memcache-php-extension-on-centos-5x/">http://www.sohailriaz.com/how-to-install-memcached-with-memcache-php-extension-on-centos-5x/</a></li>
<li><a href="https://github.com/phpredis/phpredis">https://github.com/phpredis/phpredis</a></li>
<li><a href="https://github.com/mongodb/mongo-php-driver.git">https://github.com/mongodb/mongo-php-driver.git</a></li>
<li>
<a href="http://www.phpinternalsbook.com/build_system/building_php.html">http://www.phpinternalsbook.com/build_system/building_php.html</a> </li>
<li><a href="http://php.net/manual/en/configure.about.php">http://php.net/manual/en/configure.about.php</a></li>
<li><a href="http://gediminasm.org/post/compile-php">http://gediminasm.org/post/compile-php</a></li>
<li><a href="http://php.net/manual/en/install.fpm.configuration.php">http://php.net/manual/en/install.fpm.configuration.php</a></li>
<li><a href="http://php.net/manual/de/configuration.php">http://php.net/manual/de/configuration.php</a></li>
<li><a href="http://superuser.com/questions/408294/how-can-i-enable-readline-for-php-5-4-on-ubuntu-11-10">http://superuser.com/questions/408294/how-can-i-enable-readline-for-php-5-4-on-ubuntu-11-10</a></li>
<li><a href="http://php.net/manual/en/install.unix.nginx.php">http://php.net/manual/en/install.unix.nginx.php</a></li>
<li><a href="https://github.com/php/php-src">https://github.com/php/php-src</a></li>
<li><a href="https://github.com/drj-io/php7-debian-build">https://github.com/drj-io/php7-debian-build</a></li>
<li><a href="http://repos.zend.com/zend-server/early-access/php7/">http://repos.zend.com/zend-server/early-access/php7/</a></li>
<li><a href="https://git.php.net/">https://git.php.net/</a></li>
<li><a href="https://drive.google.com/file/d/0B3UKOMH_4lgBUTdjUGxIZ3l1Ukk/view">https://drive.google.com/file/d/0B3UKOMH_4lgBUTdjUGxIZ3l1Ukk/view</a></li>
<li><a href="https://wiki.php.net/phpng-int">https://wiki.php.net/phpng-int</a></li>
</ul>

<h3>
<a id="docker" class="anchor" href="#docker" aria-hidden="true"><span class="octicon octicon-link"></span></a>docker</h3>

<ul>
<li><a href="https://docs.docker.com/userguide/dockervolumes/">https://docs.docker.com/userguide/dockervolumes/</a></li>
<li><a href="http://nathanleclaire.com/blog/2014/07/12/10-docker-tips-and-tricks-that-will-make-you-sing-a-whale-song-of-joy/">http://nathanleclaire.com/blog/2014/07/12/10-docker-tips-and-tricks-that-will-make-you-sing-a-whale-song-of-joy/</a></li>
<li><a href="https://coreos.com/docs/launching-containers/building/customizing-docker/">https://coreos.com/docs/launching-containers/building/customizing-docker/</a></li>
<li><a href="https://docs.docker.com/articles/using_supervisord/">https://docs.docker.com/articles/using_supervisord/</a></li>
<li><a href="http://boot2docker.io/">http://boot2docker.io/</a></li>
<li><a href="https://github.com/docker/docker/blob/master/docs/sources/articles/dockerfile_best-practices.md">https://github.com/docker/docker/blob/master/docs/sources/articles/dockerfile_best-practices.md</a></li>
<li><a href="https://docs.docker.com/reference/builder/#expose">https://docs.docker.com/reference/builder/#expose</a></li>
<li><a href="https://github.com/likol/docker-php7-fpm">https://github.com/likol/docker-php7-fpm</a></li>
<li><a href="https://docs.docker.com/userguide/dockerizing/">https://docs.docker.com/userguide/dockerizing/</a></li>
<li><a href="https://docs.docker.com/articles/networking/">https://docs.docker.com/articles/networking/</a></li>
<li><a href="https://docs.docker.com/reference/commandline/cli/">https://docs.docker.com/reference/commandline/cli/</a></li>
<li><a href="http://geoffrey.io/a-php-development-environment-with-docker.html">http://geoffrey.io/a-php-development-environment-with-docker.html</a></li>
<li><a href="https://github.com/janatzend/docker-php7-nightly-build">https://github.com/janatzend/docker-php7-nightly-build</a></li>
</ul>

<h3>
<a id="systemd" class="anchor" href="#systemd" aria-hidden="true"><span class="octicon octicon-link"></span></a>system.d</h3>

<ul>
<li><a href="https://github.com/systemd/php/blob/master/php-fpm.service">https://github.com/systemd/php/blob/master/php-fpm.service</a></li>
</ul>

<p>I hope I helped at least one person otherwise at least I learned something new :)</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/chilimatic/docker-php7-nightly-debian-jessy">Docker-php7-nightly-debian-jessy</a> is maintained by <a href="https://github.com/chilimatic">chilimatic</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

